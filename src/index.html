<%
  var parseData = function(data) {
    var dataObj = {};
    data.forEach(function(c) {
      var country = c.country;
      var players = c.totalplayers;
      if (!dataObj[country]) { dataObj[country] = {} }
      dataObj[country].players = players;

      if (c.subcountry && c.subplayers) { 
        var subCountry = c.subcountry;
        var subPlayers = c.subplayers;

        if (!dataObj[country].subData) { dataObj[country].subData = {} }
        dataObj[country].subData[subCountry] = subPlayers;
      }
    });
    return dataObj;
  };

  var soundersData = parseData(json.MLSCountries_Sounders_Total);
  var worldData = parseData(json.MLSCountries_Current_Total);


  var teamData = {};
  json.MLSCountries_Current_Clean.forEach(function(t) {
    var id = t.id;
    var team = t.team;
    var color = t.color;
    var country = t.country;
    var players = t.totalplayers;

    if (!teamData[id]) { teamData[id] = {} }
    teamData[id].team = team;
    teamData[id].color = color;
    if (!teamData[id][country]) { teamData[id][country] = {} }
    teamData[id][country].players = players;

    if (t.subcountry && t.subplayers) { 
      var subCountry = t.subcountry;
      var subPlayers = t.subplayers;

      if (!teamData[id][country].subData) { teamData[id][country].subData = {} }
      teamData[id][country].subData[subCountry] = subPlayers;
    }
  });
%><!doctype html>
<html>
  <head>
    <title><%= json.project.title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href='http://fonts.googleapis.com/css?family=Ropa+Sans:400,400italic|Lato' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <%= t.include("partials/_adHead.html") %>
  </head>

  <body>

    <div class="badge-container">
      <div class="inner">
        <div class="badge-group">
          <div class="badge">
            <img src="./assets/mls.gif" data-team="mls" data-name="MLS"></img>
          </div>
        <% var index = 0 %>
        <% for (var t in teamData) { %>
          <% index++ %>
          <% if (index % 3 == 0) { %>
            <div class="badge-group">
          <% } %>
            <div class="badge">
              <img src="./assets/<%= t %>.gif" data-team="<%= t %>" data-name="<%= teamData[t].team %>"></img>
            </div>
          <% if (index % 3 == 2) { %>
            </div>
          <% } %>
        <% } %>
      </div>
    </div>

    <div class="map-container">
      <div class="aspect-ratio-outer">
        <div class="aspect-ratio-inner">
          <div id="map"></div>
          <div class="toggle">
            <button class="selected" data-team="seattle"><i class="fa fa-map-marker"></i> This Season</button>
            <button data-team="sounders"><i class="fa fa-map-marker"></i> 2009 - Present</button>
          </div>
        </div>
      </div>
    </div>

    <div class="legend"></div>

    <script>

      var soundersData = <%= JSON.stringify(soundersData) %>;
      var teamData = window.teamData = <%= JSON.stringify(teamData) %>;
      var worldData = <%= JSON.stringify(worldData) %>;
      
    </script>
    <script src="app.js"></script>
    <%= json.project.production ? t.include("partials/_adFoot.html") : "" %>
    <%= json.project.production ? t.include("partials/_workHere.html") : "" %>
  </body>
</html>
